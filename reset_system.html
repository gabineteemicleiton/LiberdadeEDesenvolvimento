<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Sistema - Gabinete Digital</title>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(-45deg, #1E3C72, #2A5298, #1E3C72);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            text-align: center;
            max-width: 500px;
            width: 100%;
        }
        .btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: all 0.3s ease;
        }
        .btn:hover {
            background: #c82333;
            transform: translateY(-2px);
        }
        .btn-success {
            background: #28a745;
        }
        .btn-success:hover {
            background: #218838;
        }
        .status {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: left;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîÑ Reset Sistema</h1>
        <p>Use esta p√°gina para resetar e corrigir o sistema de intera√ß√µes.</p>
        
        <div class="status" id="status">
            <strong>Status Atual:</strong> Carregando...
        </div>
        
        <button class="btn" onclick="limparTodosOsDados()">üóëÔ∏è Limpar Todos os Dados</button>
        <button class="btn btn-success" onclick="criarDadosTeste()">üß™ Criar Dados de Teste</button>
        <button class="btn btn-success" onclick="verificarSistema()">üîç Verificar Sistema</button>
        
        <div style="margin-top: 30px;">
            <a href="index.html" style="color: #1E3C72; text-decoration: none;">‚Üê Voltar para o Site</a> |
            <a href="painel_interacoes.html" style="color: #1E3C72; text-decoration: none;">Painel Administrativo ‚Üí</a>
        </div>
    </div>

    <script>
        function generateProtocol() {
            const year = new Date().getFullYear();
            const randomNum = Math.floor(Math.random() * 900000) + 100000;
            return `SGT${year}${randomNum}`;
        }

        function updateStatus() {
            try {
                const interacoes = JSON.parse(localStorage.getItem('interacoesRecebidas') || '[]');
                const status = document.getElementById('status');
                
                if (interacoes.length === 0) {
                    status.innerHTML = '<strong>Status:</strong> ‚ùå Nenhuma intera√ß√£o encontrada';
                    return;
                }
                
                const tipos = {};
                interacoes.forEach(interacao => {
                    tipos[interacao.tipo] = (tipos[interacao.tipo] || 0) + 1;
                });
                
                let html = `<strong>Status:</strong> ‚úÖ ${interacoes.length} intera√ß√µes encontradas<br><br>`;
                html += '<strong>Por tipo:</strong><br>';
                Object.keys(tipos).forEach(tipo => {
                    html += `‚Ä¢ ${tipo}: ${tipos[tipo]}<br>`;
                });
                
                status.innerHTML = html;
                
            } catch (error) {
                document.getElementById('status').innerHTML = `<strong>Status:</strong> ‚ùå Erro: ${error.message}`;
            }
        }

        function limparTodosOsDados() {
            if (confirm('‚ö†Ô∏è ATEN√á√ÉO: Isso vai apagar TODOS os dados do sistema!\n\nTem certeza que deseja continuar?')) {
                try {
                    // Limpar todas as chaves relacionadas
                    const keysToRemove = [
                        'interacoesRecebidas',
                        'sugestoesCidadaos',
                        'sugestoes',
                        'interactions',
                        'photoReports',
                        'locationReports'
                    ];
                    
                    keysToRemove.forEach(key => {
                        localStorage.removeItem(key);
                    });
                    
                    alert('‚úÖ Todos os dados foram limpos com sucesso!');
                    updateStatus();
                } catch (error) {
                    alert('‚ùå Erro ao limpar dados: ' + error.message);
                }
            }
        }

        function criarDadosTeste() {
            try {
                const interacoesTeste = [
                    {
                        tipo: 'SUGESTAO',
                        titulo: 'Sugest√£o para melhorar a ilumina√ß√£o da pra√ßa',
                        descricao: 'Sugiro melhorar a ilumina√ß√£o da Pra√ßa Central para aumentar a seguran√ßa no per√≠odo noturno.',
                        protocolo: generateProtocol(),
                        data: new Date().toISOString(),
                        nome: 'Maria Silva',
                        status: 'nova'
                    },
                    {
                        tipo: 'FOTO',
                        titulo: 'Foto enviada por Jo√£o Santos - Centro',
                        descricao: 'Buraco na rua causando problemas para os motoristas',
                        protocolo: generateProtocol(),
                        data: new Date().toISOString(),
                        nome: 'Jo√£o Santos',
                        local: 'Rua Principal, Centro',
                        nomeArquivo: 'buraco_rua.jpg',
                        status: 'nova'
                    },
                    {
                        tipo: 'LOCALIZACAO',
                        titulo: 'Localiza√ß√£o marcada - Bairro Novo',
                        descricao: 'Falta de sinaliza√ß√£o na esquina',
                        protocolo: generateProtocol(),
                        data: new Date().toISOString(),
                        nome: 'Ana Costa',
                        local: 'Esquina da Rua A com Rua B',
                        coordenadas: '-10.4333, -39.3333',
                        status: 'nova'
                    }
                ];

                localStorage.setItem('interacoesRecebidas', JSON.stringify(interacoesTeste));
                alert('‚úÖ Dados de teste criados com sucesso!');
                updateStatus();
                
            } catch (error) {
                alert('‚ùå Erro ao criar dados de teste: ' + error.message);
            }
        }

        function verificarSistema() {
            try {
                const interacoes = JSON.parse(localStorage.getItem('interacoesRecebidas') || '[]');
                
                let relatorio = 'üìä RELAT√ìRIO DO SISTEMA:\n\n';
                relatorio += `Total de intera√ß√µes: ${interacoes.length}\n\n`;
                
                const tipos = {};
                const protocolos = [];
                
                interacoes.forEach(interacao => {
                    tipos[interacao.tipo] = (tipos[interacao.tipo] || 0) + 1;
                    protocolos.push(interacao.protocolo);
                });
                
                relatorio += 'Distribui√ß√£o por tipo:\n';
                Object.keys(tipos).forEach(tipo => {
                    relatorio += `‚Ä¢ ${tipo}: ${tipos[tipo]}\n`;
                });
                
                relatorio += '\nProtocolos:\n';
                protocolos.forEach(protocolo => {
                    relatorio += `‚Ä¢ ${protocolo}\n`;
                });
                
                relatorio += '\n‚úÖ Sistema funcionando corretamente!';
                
                alert(relatorio);
                
            } catch (error) {
                alert('‚ùå Erro no sistema: ' + error.message);
            }
        }

        // Atualizar status ao carregar
        window.addEventListener('load', updateStatus);
    </script>
</body>
</html>