<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Intera√ß√£o</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .botao { padding: 10px 20px; margin: 10px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .resultado { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>üß™ Teste do Sistema de Intera√ß√µes</h1>
    
    <button class="botao" onclick="criarSugestao()">Criar Sugest√£o</button>
    <button class="botao" onclick="criarFoto()">Criar Foto</button>
    <button class="botao" onclick="criarLocalizacao()">Criar Localiza√ß√£o</button>
    <button class="botao" onclick="verificarDados()">Verificar Dados</button>
    <button class="botao" onclick="limparDados()">Limpar Dados</button>
    
    <div id="resultado" class="resultado"></div>
    
    <script>
        function generateProtocol() {
            const year = new Date().getFullYear();
            const randomNum = Math.floor(Math.random() * 900000) + 100000;
            return `SGT${year}${randomNum}`;
        }
        
        function criarSugestao() {
            const interacao = {
                tipo: 'SUGESTAO',
                titulo: 'Sugest√£o de Teste',
                descricao: 'Esta √© uma sugest√£o de teste criada automaticamente',
                protocolo: generateProtocol(),
                data: new Date().toISOString(),
                nome: 'Cidad√£o Teste',
                status: 'nova'
            };
            
            salvarInteracao(interacao);
            mostrarResultado('‚úÖ Sugest√£o criada com sucesso!', interacao);
        }
        
        function criarFoto() {
            const interacao = {
                tipo: 'FOTO',
                titulo: 'Foto de Teste - Pra√ßa Central',
                descricao: 'Foto do local: Pra√ßa Central',
                protocolo: generateProtocol(),
                data: new Date().toISOString(),
                nome: 'Cidad√£o Teste',
                local: 'Pra√ßa Central',
                nomeArquivo: 'teste.jpg',
                status: 'nova'
            };
            
            salvarInteracao(interacao);
            mostrarResultado('üì∑ Foto criada com sucesso!', interacao);
        }
        
        function criarLocalizacao() {
            const interacao = {
                tipo: 'LOCALIZACAO',
                titulo: 'Localiza√ß√£o marcada - Rua das Flores',
                descricao: 'Problema na via p√∫blica',
                protocolo: generateProtocol(),
                data: new Date().toISOString(),
                nome: 'Cidad√£o Teste',
                local: 'Rua das Flores',
                coordenadas: '-10.4333, -39.3333',
                status: 'nova'
            };
            
            salvarInteracao(interacao);
            mostrarResultado('üìç Localiza√ß√£o criada com sucesso!', interacao);
        }
        
        function salvarInteracao(interacao) {
            try {
                const interacoes = JSON.parse(localStorage.getItem('interacoesRecebidas') || '[]');
                interacoes.push(interacao);
                localStorage.setItem('interacoesRecebidas', JSON.stringify(interacoes));
                console.log('‚úÖ Intera√ß√£o salva:', interacao);
            } catch (error) {
                console.error('‚ùå Erro ao salvar:', error);
            }
        }
        
        function verificarDados() {
            try {
                const interacoes = JSON.parse(localStorage.getItem('interacoesRecebidas') || '[]');
                const resultado = document.getElementById('resultado');
                
                if (interacoes.length === 0) {
                    resultado.innerHTML = '<strong>üì¶ Nenhuma intera√ß√£o encontrada</strong>';
                    return;
                }
                
                let html = `<strong>üìä Total de intera√ß√µes: ${interacoes.length}</strong><br><br>`;
                
                const tipos = {};
                interacoes.forEach(interacao => {
                    tipos[interacao.tipo] = (tipos[interacao.tipo] || 0) + 1;
                });
                
                html += '<strong>üìã Por tipo:</strong><br>';
                Object.keys(tipos).forEach(tipo => {
                    html += `‚Ä¢ ${tipo}: ${tipos[tipo]}<br>`;
                });
                
                html += '<br><strong>üìù √öltimas 3 intera√ß√µes:</strong><br>';
                interacoes.slice(-3).forEach(interacao => {
                    html += `‚Ä¢ ${interacao.protocolo} - ${interacao.tipo} - ${interacao.titulo}<br>`;
                });
                
                resultado.innerHTML = html;
                
            } catch (error) {
                mostrarResultado('‚ùå Erro ao verificar dados: ' + error.message);
            }
        }
        
        function limparDados() {
            if (confirm('Tem certeza que deseja limpar todos os dados?')) {
                localStorage.removeItem('interacoesRecebidas');
                mostrarResultado('üóëÔ∏è Dados limpos com sucesso!');
            }
        }
        
        function mostrarResultado(mensagem, dados = null) {
            const resultado = document.getElementById('resultado');
            let html = `<strong>${mensagem}</strong>`;
            
            if (dados) {
                html += `<br><br><strong>Dados:</strong><br>`;
                html += `‚Ä¢ Protocolo: ${dados.protocolo}<br>`;
                html += `‚Ä¢ Tipo: ${dados.tipo}<br>`;
                html += `‚Ä¢ T√≠tulo: ${dados.titulo}<br>`;
                html += `‚Ä¢ Data: ${new Date(dados.data).toLocaleString()}<br>`;
            }
            
            resultado.innerHTML = html;
        }
        
        // Verificar dados ao carregar a p√°gina
        window.addEventListener('load', verificarDados);
    </script>
</body>
</html>